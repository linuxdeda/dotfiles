/* SPDX-License-Identifier: GPL-3.0-or-later */

/* Firefox Window Controls Theming (Kiwi - alt set) */
@namespace xul "http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";

/* Ensure the button box aligns items centrally like other toolbar icons */
#nav-bar .titlebar-buttonbox,
#TabsToolbar .titlebar-buttonbox,
#toolbar-menubar .titlebar-buttonbox,
#TabsToolbar .titlebar-buttonbox-container,
#nav-bar .titlebar-buttonbox-container, 
#toolbar-menubar .titlebar-buttonbox-container {
  display: flex !important;
  align-items: center !important;
  gap: 11px !important;
  padding-inline-start: 8px;
  padding-inline-end: 8px;
}

#nav-bar .titlebar-spacer{
  width: 6px !important;
}

#nav-bar {
  padding-left: 4px !important;
}

#menubar-items {
  padding: 6px;
}

#TabsToolbar .toolbar-items {
  padding: 0 10px !important;
}

/* When tabs are in the titlebar (horizontal tabs):
 * - Never show nav-bar copies
 * - Only show the TabsToolbar copy
 */
:root[tabsintitlebar] #nav-bar .titlebar-buttonbox-container,
:root[tabsintitlebar] #nav-bar .titlebar-buttonbox {
  display: none !important;
}
:root[tabsintitlebar] #TabsToolbar .titlebar-buttonbox-container,
:root[tabsintitlebar] #TabsToolbar .titlebar-buttonbox {
  display: flex !important;
  z-index: 1 !important;
  align-items: stretch !important;
}

/* Additionally ensure any direct nav-bar titlebar buttons are hidden when tabs are in the titlebar */
:root[tabsintitlebar] #nav-bar .titlebar-button,
:root[tabsintitlebar] #nav-bar .titlebar-close,
:root[tabsintitlebar] #nav-bar .titlebar-min,
:root[tabsintitlebar] #nav-bar .titlebar-max,
:root[tabsintitlebar] #nav-bar .titlebar-restore {
  display: none !important;
}

/* Force-hide any nav-bar titlebar elements when tabs are in the titlebar (max specificity) */
:root[tabsintitlebar] #nav-bar > :is(.titlebar-buttonbox-container, .titlebar-spacer),
:root[tabsintitlebar] #nav-bar .titlebar-buttonbox,
:root[tabsintitlebar] #nav-bar .titlebar-button {
  display: none !important;
}

/* Prefer showing controls in the first visible toolbar: TabsToolbar when tabs are visible (horizontal tabs).
 * If tabs are hidden (common with vertical tabs), show them in the nav-bar instead. */
#navigator-toolbox:not([tabs-hidden]) > #nav-bar > :is(.titlebar-buttonbox-container, .titlebar-spacer) {
  display: none !important;
}
#navigator-toolbox:not([tabs-hidden]) > #TabsToolbar > :is(.titlebar-buttonbox-container, .titlebar-spacer) {
  display: flex !important;
}

#navigator-toolbox[tabs-hidden] > #TabsToolbar > :is(.titlebar-buttonbox-container, .titlebar-spacer) {
  display: none !important;
}
#navigator-toolbox[tabs-hidden] > #nav-bar > :is(.titlebar-buttonbox-container, .titlebar-spacer) {
  display: flex !important;
}

/* Menubar priority: if the menubar is permanently visible, show controls there
 * and hide from the TabsToolbar and nav-bar. */
:root:not([chromehidden~="menubar"], [inFullscreen])
  #toolbar-menubar:not([autohide], [collapsed])
  > :is(.titlebar-buttonbox-container, .titlebar-spacer) {
  display: flex !important;
}

:root:not([chromehidden~="menubar"], [inFullscreen])
  #toolbar-menubar:not([autohide], [collapsed])
  ~ :is(#TabsToolbar, #nav-bar)
  > :is(.titlebar-buttonbox-container, .titlebar-spacer) {
  display: none !important;
}

/* Titlebar (native) priority: when native titlebar is used, do not show window controls
 * in menubar, tab bar, or nav-bar. Host system window manages them. */
:root:not([customtitlebar]) :is(#toolbar-menubar, #TabsToolbar, #nav-bar)
  > :is(.titlebar-buttonbox-container, .titlebar-spacer),
:root:not([customtitlebar]) :is(#toolbar-menubar, #TabsToolbar, #nav-bar)
  .titlebar-buttonbox,
:root:not([customtitlebar]) :is(#toolbar-menubar, #TabsToolbar, #nav-bar)
  .titlebar-button {
  display: none !important;
}

/* Vertical tabs detection and fallback logic
 * Some Firefox builds (Nightly/Devedition/with experiments or extensions) hide or collapse #TabsToolbar
 * when vertical tabs are active. If TabsToolbar is not visible, re-enable the nav-bar buttons instead.
 * We use :has() to detect a hidden/collapsed TabsToolbar. Also support an optional [verticaltabs] root attr. */
@supports selector(:has(*)) {
  /* TabsToolbar explicitly hidden/collapsed */
  :root[tabsintitlebar]:has(#TabsToolbar[hidden]),
  :root[tabsintitlebar]:has(#TabsToolbar[collapsed="true"]),
  :root[tabsintitlebar]:has(#TabsToolbar[style*="display: none"]),
  /* Optional attribute used by some variants */
  :root[tabsintitlebar][verticaltabs],
  /* As a last resort, if TabsToolbar is missing */
  :root[tabsintitlebar]:not(:has(#TabsToolbar)) {
    /* Show nav-bar buttons again */
    #nav-bar .titlebar-buttonbox-container,
    #nav-bar .titlebar-buttonbox {
      display: flex !important;
    }
    /* Hide TabsToolbar copy to avoid duplicates */
    #TabsToolbar .titlebar-buttonbox-container,
    #TabsToolbar .titlebar-buttonbox {
      display: none !important;
    }
  }
}

/* Reset native look and hide built-in icons to avoid double rendering */
#nav-bar .titlebar-button,
#toolbar-menubar .titlebar-button,
#TabsToolbar .titlebar-button {
  appearance: none !important;
  -moz-appearance: none !important;
  background: none !important;
  background-position: center center !important;
  background-repeat: no-repeat !important;
  background-size: 16px 16px !important;
  border: 0 !important;
  box-shadow: none !important;
  list-style-image: none !important;
  width: 16px !important;
  height: 16px !important;
  padding: 0 !important;
  margin: 0 !important;
  display: inline-block !important;
  vertical-align: middle !important;
  /* Allow window dragging via titlebar buttons area (matches original behavior) */
  -moz-window-dragging: drag !important;
}
#nav-bar .titlebar-button .toolbarbutton-icon,
#toolbar-menubar .titlebar-button .toolbarbutton-icon,
#TabsToolbar .titlebar-button .toolbarbutton-icon {
  display: none !important;
}

/* Base images */
#nav-bar .titlebar-close,
#toolbar-menubar .titlebar-close,
#TabsToolbar .titlebar-close{
  background-image: image-set(
    url("titlebuttons/button-close.png") 1x,
    url("titlebuttons/button-close@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-max,
#toolbar-menubar .titlebar-max,
#TabsToolbar .titlebar-max {
  background-image: image-set(
    url("titlebuttons/button-maximize.png") 1x,
    url("titlebuttons/button-maximize@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-min,
#toolbar-menubar .titlebar-min,
#TabsToolbar .titlebar-min {
  background-image: image-set(
    url("titlebuttons/button-minimize.png") 1x,
    url("titlebuttons/button-minimize@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-restore,
#toolbar-menubar .titlebar-restore,
#TabsToolbar .titlebar-restore,
:root[sizemode="maximized"] #nav-bar .titlebar-max,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-max,
:root[sizemode="maximized"] #TabsToolbar .titlebar-max {
  background-image: image-set(
    url("titlebuttons/button-restore.png") 1x,
    url("titlebuttons/button-restore@2.png") 2x
  ) !important;
}

/* Only show restore when maximized; hide maximize then */
#nav-bar .titlebar-restore,
#toolbar-menubar .titlebar-restore,
#TabsToolbar .titlebar-restore { display: none !important; }

:root[sizemode="maximized"] #nav-bar .titlebar-restore,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-restore,
:root[sizemode="maximized"] #TabsToolbar .titlebar-restore { display: inline-block !important; }

:root[sizemode="maximized"] #nav-bar .titlebar-max,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-max,
:root[sizemode="maximized"] #TabsToolbar .titlebar-max { display: none !important; }

/* Per-button hover */
#nav-bar .titlebar-close:hover,
#toolbar-menubar .titlebar-close:hover,
#TabsToolbar .titlebar-close:hover {
  background-image: image-set(
    url("titlebuttons/button-close-hover-alt.png") 1x,
    url("titlebuttons/button-close-hover-alt@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-max:hover,
#toolbar-menubar .titlebar-max:hover,
#TabsToolbar .titlebar-max:hover {
  background-image: image-set(
    url("titlebuttons/button-maximize-hover-alt.png") 1x,
    url("titlebuttons/button-maximize-hover-alt@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-min:hover,
#toolbar-menubar .titlebar-min:hover,
#TabsToolbar .titlebar-min:hover {
  background-image: image-set(
    url("titlebuttons/button-minimize-hover.png") 1x,
    url("titlebuttons/button-minimize-hover@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-restore:hover,
#toolbar-menubar .titlebar-restore:hover,
#TabsToolbar .titlebar-restore:hover,
:root[sizemode="maximized"] #nav-bar .titlebar-max:hover,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-max:hover,
:root[sizemode="maximized"] #TabsToolbar .titlebar-max:hover {
  background-image: image-set(
    url("titlebuttons/button-restore-hover-alt.png") 1x,
    url("titlebuttons/button-restore-hover-alt@2.png") 2x
  ) !important;
}

/* Group hover (hovering any button hovers them all) */
#nav-bar .titlebar-buttonbox-container:hover .titlebar-close,
#toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-close,
#TabsToolbar .titlebar-buttonbox-container:hover .titlebar-close,
#nav-bar .titlebar-buttonbox:hover .titlebar-close,
#toolbar-menubar .titlebar-buttonbox:hover .titlebar-close,
#TabsToolbar .titlebar-buttonbox:hover .titlebar-close {
  background-image: image-set(
    url("titlebuttons/button-close-hover-alt.png") 1x,
    url("titlebuttons/button-close-hover-alt@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-buttonbox-container:hover .titlebar-min,
#toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-min,
#TabsToolbar .titlebar-buttonbox-container:hover .titlebar-min,
#nav-bar .titlebar-buttonbox:hover .titlebar-min,
#toolbar-menubar .titlebar-buttonbox:hover .titlebar-min,
#TabsToolbar .titlebar-buttonbox:hover .titlebar-min {
  background-image: image-set(
    url("titlebuttons/button-minimize-hover.png") 1x,
    url("titlebuttons/button-minimize-hover@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-buttonbox-container:hover .titlebar-max,
#toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-max,
#TabsToolbar .titlebar-buttonbox-container:hover .titlebar-max,
#nav-bar .titlebar-buttonbox:hover .titlebar-max,
#toolbar-menubar .titlebar-buttonbox:hover .titlebar-max,
#TabsToolbar .titlebar-buttonbox:hover .titlebar-max {
  background-image: image-set(
    url("titlebuttons/button-maximize-hover-alt.png") 1x,
    url("titlebuttons/button-maximize-hover-alt@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-buttonbox-container:hover .titlebar-restore,
#toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-restore,
#TabsToolbar .titlebar-buttonbox-container:hover .titlebar-restore,
#nav-bar .titlebar-buttonbox:hover .titlebar-restore,
#toolbar-menubar .titlebar-buttonbox:hover .titlebar-restore,
#TabsToolbar .titlebar-buttonbox:hover .titlebar-restore,
:root[sizemode="maximized"] #nav-bar .titlebar-buttonbox-container:hover .titlebar-max,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-max,
:root[sizemode="maximized"] #TabsToolbar .titlebar-buttonbox-container:hover .titlebar-max,
:root[sizemode="maximized"] #nav-bar .titlebar-buttonbox:hover .titlebar-max,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-buttonbox:hover .titlebar-max,
:root[sizemode="maximized"] #TabsToolbar .titlebar-buttonbox:hover .titlebar-max {
  background-image: image-set(
    url("titlebuttons/button-restore-hover-alt.png") 1x,
    url("titlebuttons/button-restore-hover-alt@2.png") 2x
  ) !important;
}

/* Pressed (active) state overrides - ensure visible feedback when clicking */
#nav-bar .titlebar-close:active,
#toolbar-menubar .titlebar-close:active,
#TabsToolbar .titlebar-close:active {
  background-image: image-set(
    url("titlebuttons/button-close-active-alt.png") 1x,
    url("titlebuttons/button-close-active-alt@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-buttonbox-container:hover .titlebar-close:active,
#toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-close:active,
#nav-bar .titlebar-buttonbox:hover .titlebar-close:active,
#toolbar-menubar .titlebar-buttonbox:hover .titlebar-close:active,
#TabsToolbar .titlebar-buttonbox-container:hover .titlebar-close:active,
#TabsToolbar .titlebar-buttonbox:hover .titlebar-close:active {
  background-image: image-set(
    url("titlebuttons/button-close-active-alt.png") 1x,
    url("titlebuttons/button-close-active-alt@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-min:active,
#toolbar-menubar .titlebar-min:active,
#TabsToolbar .titlebar-min:active {
  background-image: image-set(
    url("titlebuttons/button-minimize-active.png") 1x,
    url("titlebuttons/button-minimize-active@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-buttonbox-container:hover .titlebar-min:active,
#toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-min:active,
#nav-bar .titlebar-buttonbox:hover .titlebar-min:active,
#toolbar-menubar .titlebar-buttonbox:hover .titlebar-min:active,
#TabsToolbar .titlebar-buttonbox-container:hover .titlebar-min:active,
#TabsToolbar .titlebar-buttonbox:hover .titlebar-min:active {
  background-image: image-set(
    url("titlebuttons/button-minimize-active.png") 1x,
    url("titlebuttons/button-minimize-active@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-max:active,
#toolbar-menubar .titlebar-max:active,
#TabsToolbar .titlebar-max:active {
  background-image: image-set(
    url("titlebuttons/button-maximize-active-alt.png") 1x,
    url("titlebuttons/button-maximize-active-alt@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-buttonbox-container:hover .titlebar-max:active,
#toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-max:active,
#nav-bar .titlebar-buttonbox:hover .titlebar-max:active,
#toolbar-menubar .titlebar-buttonbox:hover .titlebar-max:active,
#TabsToolbar .titlebar-buttonbox-container:hover .titlebar-max:active,
#TabsToolbar .titlebar-buttonbox:hover .titlebar-max:active {
  background-image: image-set(
    url("titlebuttons/button-maximize-active-alt.png") 1x,
    url("titlebuttons/button-maximize-active-alt@2.png") 2x
  ) !important;
}
#nav-bar .titlebar-restore:active,
#toolbar-menubar .titlebar-restore:active,
#TabsToolbar .titlebar-restore:active,
:root[sizemode="maximized"] #nav-bar .titlebar-max:active,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-max:active,
:root[sizemode="maximized"] #nav-bar .titlebar-buttonbox .titlebar-max:active,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-buttonbox .titlebar-max:active {
  background-image: image-set(
    url("titlebuttons/button-restore-active-alt.png") 1x,
    url("titlebuttons/button-restore-active-alt@2.png") 2x
  ) !important;
}
:root[sizemode="maximized"] #nav-bar .titlebar-buttonbox-container:hover .titlebar-max:active,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-max:active,
:root[sizemode="maximized"] #nav-bar .titlebar-buttonbox:hover .titlebar-max:active,
:root[sizemode="maximized"] #toolbar-menubar .titlebar-buttonbox:hover .titlebar-max:active,
:root[tabsintitlebar][sizemode="maximized"] #TabsToolbar .titlebar-buttonbox-container:hover .titlebar-max:active,
:root[tabsintitlebar][sizemode="maximized"] #TabsToolbar .titlebar-buttonbox:hover .titlebar-max:active,
#nav-bar .titlebar-buttonbox-container:hover .titlebar-restore:active,
#toolbar-menubar .titlebar-buttonbox-container:hover .titlebar-restore:active,
#nav-bar .titlebar-buttonbox:hover .titlebar-restore:active,
#toolbar-menubar .titlebar-buttonbox:hover .titlebar-restore:active,
#TabsToolbar .titlebar-buttonbox-container:hover .titlebar-restore:active,
#TabsToolbar .titlebar-buttonbox:hover .titlebar-restore:active {
  background-image: image-set(
    url("titlebuttons/button-restore-active-alt.png") 1x,
    url("titlebuttons/button-restore-active-alt@2.png") 2x
  ) !important;
}